<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Admin Panel: Health & Life</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .item { border:1px solid #ddd; padding:10px; margin:5px 0; border-radius:5px; }
        input[type="text"] { width: 300px; padding:5px; }
        button { cursor:pointer; padding:5px 10px; background:#007bff; color:white; border:none; border-radius:4px; }
    </style>
</head>
<body>
    <h1>Admin Panel: จัดการเนื้อหา</h1>
    <div id="status">Loading...</div>
    <div id="content"></div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        const supabase = createClient('https://wzwyotzzxycqfwercakh.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6d3lvdHp6eHljcWZ3ZXJjYWtoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNTg3MTMsImV4cCI6MjA3MjYzNDcxM30.lgiAf9oBUqsaWGb3u_80wuoKAODQHE_lIBxpGumhrno');

        // Render Tables
        async function load() {
            const {data:s1} = await supabase.from('customer_replies_s1').select('*').order('id');
            renderTable('S1: เปิดตัว', s1, 'customer_replies_s1');
            document.getElementById('status').innerText = "พร้อม";
        }

        function renderTable(title, data, tableName) {
            const div = document.createElement('div');
            div.innerHTML = `<h2>${title}</h2>`;
            data.forEach(row => {
                const d = document.createElement('div');
                d.className = 'item';
                // Handle Array Display
                let pType = row.product_type;
                if(Array.isArray(pType)) pType = pType.join(','); 
                
                d.innerHTML = `
                    ID: ${row.id} | Turn: ${row.turn_index || ''} <br>
                    Product Tags: <input type="text" value="${pType}" id="pt_${tableName}_${row.id}">
                    <button onclick="window.saveTag('${tableName}', ${row.id})">บันทึก Tag</button>
                `;
                div.appendChild(d);
            });
            document.getElementById('content').appendChild(div);
        }

        window.saveTag = async (table, id) => {
            const val = document.getElementById(`pt_${table}_${id}`).value;
            // Convert "Health, all" string -> ["Health", "all"] array
            const arr = val.split(',').map(s => s.trim()).filter(s => s!=='');
            
            const {error} = await supabase.from(table).update({ product_type: arr }).eq('id', id);
            if(error) alert("Error: " + error.message);
            else alert("Saved Array: " + JSON.stringify(arr));
        };

        load();
    </script>
</body>
</html>
